<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Group Exam Records</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap" rel="stylesheet" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body {
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
            color: #ffffff; text-align: center; padding: 20px;
            background: linear-gradient(135deg, #4d6378, #283949, #182c3f, #051423);
            background-size: 400% 400%; animation: randomGradient 20s ease-in-out infinite;
            position: relative; overflow-y: scroll; opacity: 0;
            animation: fadeIn 2s ease-in forwards, randomGradient 20s ease-in-out infinite;
        }
        @keyframes fadeIn { to { opacity: 1; } }
        #stars-container { position: absolute; bottom: 0; left: 0; width: 100%; height: 40vh; overflow: hidden; pointer-events: none; }
        .star { position: absolute; background: white; opacity: 0.3; clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); animation: twinkle 3s infinite alternate ease-in-out; }
        @keyframes twinkle { from { opacity: 0.2; transform: scale(0.8) rotate(0deg); } to { opacity: 0.7; transform: scale(1.3) rotate(15deg); } }
        @keyframes randomGradient {
            0% { background-position: 20% 30%; }
            20% { background-position: 80% 40%; }
            40% { background-position: 60% 80%; }
            60% { background-position: 30% 20%; }
            80% { background-position: 90% 70%; }
            100% { background-position: 20% 30%; }
        }
        .header {
            width: 100%; background: rgba(255,255,255,0.1); padding: 15px; font-size: 20px; font-weight: 600;
            border-radius: 12px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .header .logo {
            font-size: 40px; font-weight: 700; color: #ffffff; white-space: nowrap; overflow: hidden;
            border-right: 3px solid #ffffff; width: 0; display: inline-block; position: relative; margin-left: 20px;
            animation: typing 4s steps(12, end) forwards, blink 0.6s step-end infinite;
        }
        @keyframes typing { from { width: 0; } to { width: 12ch; } }
        @keyframes blink { 70% { border-color: transparent; } }
        .header .logo::after {
            content: "ðŸ“–"; color: #ffffff; font-size: 1.1em; opacity: 0; margin-left: 1px; display: inline-block;
            animation: bookAppear 1s ease forwards; animation-delay: 4s; transform: translateY(-4px);
        }
        @keyframes bookAppear { from { opacity: 0; transform: translateY(10px) scale(0.9); } to { opacity: 1; transform: translateY(-4px) scale(1); } }
        .nav-links a { color: #fff; text-decoration: none; margin-left: 15px; font-size: 16px; font-weight: 500; }
        .nav-links a:hover { text-decoration: underline; }
        .records-container {
            background: rgba(255,255,255,0.08); backdrop-filter: blur(10px); padding: 30px 20px; border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3); margin-top: 40px; max-width: 900px; width: 100%;
        }
        .search-bar {
            margin-bottom: 24px;
            width: 100%;
            display: flex;
            justify-content: center;
        }
        .search-bar input {
            width: 60%;
            padding: 10px 16px;
            border-radius: 8px;
            border: none;
            font-size: 1.1rem;
            margin: 0 auto;
            outline: none;
        }
        h2 { font-size: 2.2rem; margin-bottom: 18px; color: #fff; }
        .exam-block {
            background: rgba(0,0,0,0.18); border-radius: 12px; margin-bottom: 30px; padding: 18px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: box-shadow 0.2s;
        }
        .exam-header { font-size: 1.1rem; font-weight: 600; margin-bottom: 10px; color: #ffeb3b; }
        .source-content {
            font-size: 0.98rem;
            color: #b3e5fc;
            background: rgba(0,0,0,0.12);
            border-radius: 8px;
            padding: 8px 10px;
            margin-bottom: 10px;
            word-break: break-word;
            max-height: 80px;
            overflow-y: auto;
        }
        .examinee-table {
            width: 100%; border-collapse: collapse; margin-top: 10px; background: rgba(255,255,255,0.05);
        }
        .examinee-table th, .examinee-table td {
            padding: 10px; border-bottom: 1px solid #3b82f6; color: #fff; font-size: 1rem;
        }
        .examinee-table th { background: #3b82f6; color: #fff; }
        .examinee-table tr:last-child td { border-bottom: none; }
        .no-exams { color: #ffb4b4; font-size: 1.2rem; margin-top: 30px; }
        @media (max-width: 900px) {
            .records-container { padding: 10px 2px; }
            .exam-block { padding: 10px 4px; }
            .examinee-table th, .examinee-table td { padding: 6px; font-size: 0.95rem; }
            .search-bar input { width: 95%; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">AI-ducation</div>
        <div class="nav-links">
            <a href="{{ url_for('homepage') }}">Home</a>
            <a href="{{ url_for('logout') }}">LogOut</a>
        </div>
    </div>
    <div id="stars-container"></div>
    <div class="records-container">
        <h2>Group Exam Records</h2>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search by content, host, or group ID..." onkeyup="filterExams()">
        </div>
        {% if group_exams %}
            <div id="examList">
            {% for exam in group_exams %}
                <div class="exam-block">
                    <div class="exam-header">
                        Group ID: <b class="group-id">{{ exam.group_id }}</b> &nbsp;|&nbsp;
                        Host: <b class="host-name">{{ exam.host_username }}</b> &nbsp;|&nbsp;
                        Date: <b>{{ exam.created_at.strftime('%Y-%m-%d %H:%M') if exam.created_at else 'N/A' }}</b>
                    </div>
                    <div class="source-content">{{ exam.source_content[:300] }}{% if exam.source_content and exam.source_content|length > 300 %}...{% endif %}</div>
                    <table class="examinee-table">
                        <thead>
                            <tr>
                                <th>Examinee</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ex in exam.examinees %}
                                <tr>
                                    <td>{{ ex.username }}</td>
                                    <td>{{ ex.score }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endfor %}
            </div>
        {% else %}
            <div class="no-exams">No group exams found.</div>
        {% endif %}
    </div>
    <script>
    const container = document.getElementById("stars-container");
    for (let i = 0; i < 40; i++) {
        const star = document.createElement("div");
        star.classList.add("star");
        star.style.top = Math.random() * 100 + "%";
        star.style.left = Math.random() * 100 + "%";
        const size = Math.random() * 7 + 8;
        star.style.width = size + "px";
        star.style.height = size + "px";
        star.style.animationDuration = (2 + Math.random() * 3) + "s";
        star.style.animationDelay = Math.random() * 5 + "s";
        container.appendChild(star);
    }

    function filterExams() {
        const input = document.getElementById('searchInput').value.toLowerCase();
        const exams = document.querySelectorAll('.exam-block');
        exams.forEach(function(exam) {
            const content = exam.querySelector('.source-content')?.textContent.toLowerCase() || '';
            const host = exam.querySelector('.host-name')?.textContent.toLowerCase() || '';
            const groupId = exam.querySelector('.group-id')?.textContent.toLowerCase() || '';
            if (
                content.includes(input) ||
                host.includes(input) ||
                groupId.includes(input)
            ) {
                exam.style.display = '';
            } else {
                exam.style.display = 'none';
            }
        });
    }
    </script>
</body>
</html>